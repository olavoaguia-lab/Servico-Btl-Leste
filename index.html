<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Controle de Efetivo (Snapshot Diário)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        /* Estilos CSS do Dashboard (Mantidos e Ajustados) */
        :root {
            --primary-dark: #1f3d7a; 
            --primary-light: #2c509b; 
            --accent-color: #00bcd4; 
            --danger: #d32f2f; 
            --success: #388e3c; 
            --warning: #ffa000; 
            --bg-gradient: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }

        body {
            background: var(--bg-gradient);
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            gap: 20px;
            grid-template-columns: 1fr;
        }

        .header, .controls {
            grid-column: 1 / -1;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .controls {
            background-color: rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: flex-start; /* Alinhamento à esquerda */
        }
        .control-group label { margin-right: 10px; font-weight: 300; }
        .control-group select, .control-group input[type="file"], .upload-btn {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
        }
        .upload-btn { background-color: var(--accent-color); }
        #csv-file-input { display: none; }

        /* Grid de Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(5px);
            transition: transform 0.3s;
        }
        .card h3 { font-size: 1.1em; margin-bottom: 10px; color: var(--accent-color); }
        .card .value { font-size: 2.5em; font-weight: 700; }

        #efetivo-total-previsto { background-color: rgba(44, 80, 155, 0.4); }
        #efetivo-presente-dia { background-color: rgba(56, 142, 60, 0.4); }
        #efetivo-ausente-dia { background-color: rgba(211, 47, 47, 0.4); }
        #total-viaturas-servico { background-color: rgba(0, 188, 212, 0.4); }


        /* Seção de Gráficos e Tabelas */
        .chart-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .chart-container {
            min-height: 350px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
        }

        /* Estilos de Tabela */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            font-size: 0.9em;
        }
        .data-table thead tr { background-color: rgba(0, 188, 212, 0.2); }
        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table tbody tr:hover { background-color: rgba(255, 255, 255, 0.05); }

        /* Responsividade para o Grid de Gráficos (3 colunas em telas grandes) */
        @media (min-width: 768px) {
            .chart-section { 
                grid-template-columns: repeat(3, 1fr); 
            }
            /* Tabela detalhada ocupando duas colunas na segunda linha */
            #tabela-detalhada-efetivo-container {
                grid-column: span 2;
            }
            /* Tabela Top Locais ocupando uma coluna na segunda linha */
            #tabela-top-locais-container {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>

    <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000;">
        <div class="spinner" style="border: 6px solid rgba(255, 255, 255, 0.3); border-top: 6px solid var(--accent-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
    </div>
    <div id="alert-message" style="display: none; position: fixed; top: 10px; right: 10px; padding: 10px 20px; border-radius: 5px; color: white; z-index: 1001; transition: opacity 0.3s;"></div>
    <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>

    <div class="dashboard-container">

        <header class="header">
            <h2>Controle de Efetivo PM - Snapshot Diário <i class="fas fa-calendar-day"></i></h2>
            <div class="date-time">
                <span id="current-date"></span><br>
                <span id="current-time" style="font-size: 0.9em;"></span>
            </div>
        </header>

        <div class="controls">
            <div class="control-group">
                <button id="upload-btn" class="upload-btn"><i class="fas fa-upload"></i> Carregar Dados (.xlsx/.csv)</button>
                <input type="file" id="csv-file-input" accept=".xlsx, .xls, .csv">
            </div>

            <div class="control-group">
                <label for="unidade-select">Unidade (Btl/Cicom):</label>
                <select id="unidade-select">
                    <option value="todas">Todas as Unidades</option>
                </select>
            </div>
            
            <span style="font-weight: 500; align-self: center;">Dados Referentes ao Arquivo Carregado.</span>
        </div>
        
        <div class="stats-grid">
            <div class="card" id="efetivo-total-previsto">
                <h3>Efetivo Total Previsto</h3>
                <p class="value" id="total-previsto">0</p>
            </div>
            <div class="card" id="efetivo-presente-dia">
                <h3>Efetivo Ativo (Presente)</h3>
                <p class="value" id="efetivo-presente-dia-card">0</p>
            </div>
            <div class="card" id="efetivo-ausente-dia">
                <h3>Total de Ausências/Faltas</h3>
                <p class="value" id="efetivo-ausente-dia-card">0</p>
            </div>
            <div class="card" id="total-viaturas-servico">
                <h3>Total de VTRs em Serviço</h3>
                <p class="value" id="vtr-servico">0</p>
            </div>
        </div>

        <div class="chart-section">
            
            <div class="chart-container" id="efetivo-chart-container">
                <h3>Distribuição Efetivo (Presente vs. Ausente) <i class="fas fa-chart-pie"></i></h3>
                <div style="height: 300px; margin-top: 10px;">
                    <canvas id="efetivoChart"></canvas>
                </div>
            </div>

            <div class="chart-container" id="graduacao-chart-container">
                <h3>Efetivo Ativo por Graduação <i class="fas fa-medal"></i></h3>
                <div style="height: 300px;">
                    <canvas id="graduacaoChart"></canvas>
                </div>
            </div>

            <div class="chart-container" id="tabela-top-locais-container">
                <h3>Top Locais/Setores de Atuação <i class="fas fa-map-marker-alt"></i></h3>
                <div id="tabela-top-locais" style="max-height: 300px; overflow-y: auto;">
                    <p style="text-align: center; margin-top: 50px;">Carregue os dados para visualizar.</p>
                </div>
            </div>
            
             <div class="chart-container" id="tabela-detalhada-efetivo-container">
                <h3>Detalhamento do Efetivo Ativo (Por Policial) <i class="fas fa-clipboard-list"></i></h3>
                <div id="tabela-detalhada-efetivo" style="max-height: 300px; overflow-y: auto;">
                    <p style="text-align: center; margin-top: 50px;">Carregue os dados para visualizar.</p>
                </div>
            </div>

        </div>

    </div>

    <script>
        // --- VARIÁVEIS GLOBAIS ---
        let rawData = []; 
        let currentFilters = {
            unidade: 'todas'
            /* Filtro de Data Removido */
        };
        
        // --- FUNÇÕES DE UTILIADE GERAIS ---
        function showLoading(show) {
            document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
        }
        function showAlert(message, type = 'success') {
            const alertElement = document.getElementById('alert-message');
            alertElement.textContent = message;
            alertElement.style.cssText = `display: block; background-color: ${type === 'success' ? 'var(--success)' : 'var(--danger)'}; opacity: 1;`;
            clearTimeout(alertElement.timer);
            alertElement.timer = setTimeout(() => {
                alertElement.style.cssText = `display: none; opacity: 0;`;
            }, 3000);
        }
        function updateCurrentDate() {
             document.getElementById('current-date').textContent = new Date().toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        function updateDateTime() {
             document.getElementById('current-time').textContent = new Date().toLocaleTimeString('pt-BR');
        }

        // --- FUNÇÕES DE PROCESSAMENTO DE DADOS ---
        function processExcelData(data) {
            if (data.length === 0) {
                showAlert('A planilha está vazia ou não contém dados válidos.', 'error');
                showLoading(false);
                return;
            }

            rawData = data; 
            
            // 1. Identifica Unidades únicas
            const unidades = new Set();
            data.forEach(item => {
                if (item.Unidade) unidades.add(item.Unidade);
            });

            // 2. Preenche o filtro Select
            populateSelect('unidade-select', Array.from(unidades), 'todas', 'Todas as Unidades');
            currentFilters.unidade = 'todas'; // Reseta o filtro de unidade
            
            // 3. Atualiza o dashboard
            updateDashboard(currentFilters);
            showLoading(false);
            showAlert('✅ Dados de efetivo carregados e dashboard atualizado!', 'success');
        }

        function populateSelect(elementId, items, defaultValue = null, defaultLabel = null) {
            const selectElement = document.getElementById(elementId);
            selectElement.innerHTML = ''; 

            if (defaultLabel !== null) {
                const defaultOption = document.createElement('option');
                defaultOption.value = defaultValue;
                defaultOption.textContent = defaultLabel;
                selectElement.appendChild(defaultOption);
            }

            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
            });
        }


        // --- FUNÇÕES DE LEITURA DE ARQUIVO ---
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                showLoading(true);
                readExcelFile(file);
            }
        }

        function readExcelFile(file) {
            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Usa header: 1 para tentar lidar com arquivos CSV/Excel com linhas em branco iniciais
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (jsonData.length < 2) {
                        throw new Error('A planilha está vazia ou não contém cabeçalhos/dados');
                    }
                    
                    // Encontra a linha de cabeçalho correta (esperando encontrar 'Unidade')
                    let headerRowIndex = -1;
                    const expectedHeaders = ['Unidade', 'Graduacao', 'Nome de Guerra', 'Identidade', 'Local de Atuacao', 'Status do Efetivo', 'VTRs em Serviço (Total da Unidade)'];

                    for (let i = 0; i < jsonData.length; i++) {
                        if (Array.isArray(jsonData[i]) && jsonData[i].includes('Unidade')) {
                            headerRowIndex = i;
                            break;
                        }
                    }

                    if (headerRowIndex === -1) {
                         throw new Error('Não foi possível encontrar o cabeçalho "Unidade" na planilha.');
                    }
                    
                    // Mapeia os dados usando o cabeçalho correto
                    const headers = jsonData[headerRowIndex].map(h => h.trim().replace(/\s+/g, '_').replace('_(Total_da_Unidade)', '').replace('VTRs_em_Serviço', 'VTRs_Servico'));
                    
                    let dataToProcess = [];
                    for (let i = headerRowIndex + 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (Array.isArray(row) && row.some(cell => cell && String(cell).trim() !== '')) { // Ignora linhas completamente vazias
                            let item = {};
                            headers.forEach((header, index) => {
                                item[header] = row[index] !== undefined ? row[index] : '';
                            });
                             if (item.Unidade) dataToProcess.push(item);
                        }
                    }

                    // Normaliza os dados
                    const normalizedData = dataToProcess.map(item => {
                        // Normaliza status e calcula efetivo
                        item.Status_Efetivo = item.Status_Efetivo ? String(item.Status_Efetivo).toUpperCase().trim() : 'NAO INFORMADO';
                        item.Efetivo_Presente = item.Status_Efetivo === 'PRESENTE' ? 1 : 0;
                        item.Efetivo_Ausente = item.Status_Efetivo !== 'PRESENTE' ? 1 : 0;
                        item.Efetivo_Previsto = 1; 
                        
                        // Garante que Identidade e VTRs_Servico existam
                        item.Identidade = item.Identidade ? String(item.Identidade) : '--';
                        item.VTRs_Servico = parseInt(item.VTRs_Servico) || 0; 

                        return item;
                    });


                    processExcelData(normalizedData);
                    
                } catch (error) {
                    console.error('❌ Erro na leitura:', error);
                    showAlert('❌ Erro ao ler arquivo: ' + error.message, 'error');
                    showLoading(false);
                }
            };
            
            reader.onerror = function(error) {
                console.error('❌ Erro no FileReader:', error);
                showAlert('❌ Erro ao ler o arquivo selecionado', 'error');
                showLoading(false);
            };
            
            reader.readAsArrayBuffer(file);
        }

        // --- FUNÇÕES DE DASHBOARD (Focadas em Efetivo) ---

        let efetivoChartInstance = null;
        let graduacaoChartInstance = null;


        /** Inicializa e configura as instâncias dos gráficos Chart.js. */
        function setupCharts() {
            const defaultOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: 'white' } }
                },
                scales: {
                    x: { ticks: { color: 'white' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                    y: { ticks: { color: 'white' }, grid: { color: 'rgba(255, 255, 255, 0.1)' }, beginAtZero: true }
                }
            };

            // 1. Efetivo (Presente vs. Ausente) - PIE Chart
            const efetivoCtx = document.getElementById('efetivoChart').getContext('2d');
            if (efetivoChartInstance) efetivoChartInstance.destroy();
            efetivoChartInstance = new Chart(efetivoCtx, {
                type: 'doughnut', 
                data: {
                    labels: ['Presente', 'Ausente/Faltas'],
                    datasets: [{
                        data: [0, 0], 
                        backgroundColor: ['var(--success)', 'var(--danger)'],
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        borderWidth: 2
                    }]
                },
                options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'bottom', labels: { color: 'white' } }
                    }
                }
            });

            // 2. Efetivo Ativo por Graduação - BAR Chart
            const graduacaoCtx = document.getElementById('graduacaoChart').getContext('2d');
            if (graduacaoChartInstance) graduacaoChartInstance.destroy();
            graduacaoChartInstance = new Chart(graduacaoCtx, {
                type: 'bar', 
                data: { labels: [], datasets: [] },
                options: { ...defaultOptions } 
            });
        }


        /** Filtra os dados e recalcula as métricas para atualização do dashboard. */
        function updateDashboard(filters) {
            // 1. Filtra os dados brutos com base na Unidade (Filtro de Data Removido)
            let filteredData = rawData.filter(item => {
                const matchesUnidade = filters.unidade === 'todas' || item.Unidade === filters.unidade;
                return matchesUnidade;
            });
            
            // 2. Cálculos das Métricas Chaves
            
            const totalPrevisto = filteredData.reduce((sum, item) => sum + (item.Efetivo_Previsto || 0), 0); 
            const totalPresente = filteredData.reduce((sum, item) => sum + (item.Efetivo_Presente || 0), 0);
            const totalAusente = totalPrevisto - totalPresente;
            
            // VTRs: Pega o valor máximo de VTRs_Servico na unidade filtrada (assumindo que VTRs é um valor único por Unidade no snapshot)
            // Se for "Todas", ele soma os valores máximos por unidade
            let totalVTRs = 0;
            if (filters.unidade === 'todas') {
                 const vtrsPorUnidade = filteredData.reduce((acc, item) => {
                    const vtrValue = parseInt(item.VTRs_Servico) || 0;
                    acc[item.Unidade] = Math.max(acc[item.Unidade] || 0, vtrValue);
                    return acc;
                }, {});
                totalVTRs = Object.values(vtrsPorUnidade).reduce((sum, vtr) => sum + vtr, 0);
            } else {
                 totalVTRs = filteredData.reduce((max, item) => Math.max(max, parseInt(item.VTRs_Servico) || 0), 0);
            }

            // Cálculos para Gráficos e Tabelas
            
            // Efetivo por Graduação
            const efetivoPorGraduacao = filteredData
                .filter(item => item.Efetivo_Presente === 1)
                .reduce((acc, item) => {
                    const grad = item.Graduacao || 'Sem Graduação';
                    acc[grad] = (acc[grad] || 0) + 1;
                    return acc;
                }, {});

            // Efetivo por Local de Atuação
            const efetivoPorLocal = filteredData
                 .filter(item => item.Efetivo_Presente === 1)
                .reduce((acc, item) => {
                    const local = item.Local_Atuacao || 'Local Indefinido';
                    acc[local] = (acc[local] || 0) + 1;
                    return acc;
                }, {});


            // 3. Atualiza os Cards de Estatísticas
            document.getElementById('total-previsto').textContent = totalPrevisto;
            document.getElementById('efetivo-presente-dia-card').textContent = totalPresente;
            document.getElementById('efetivo-ausente-dia-card').textContent = totalAusente >= 0 ? totalAusente : 0;
            document.getElementById('vtr-servico').textContent = totalVTRs;


            // 4. Atualiza os Gráficos
            updateCharts({
                presente: totalPresente,
                ausente: totalAusente,
                graduacao: efetivoPorGraduacao
            });

            // 5. Atualiza Tabelas (Locais de Atuação e Detalhamento)
            updateTopLocais(efetivoPorLocal);
            // Agora usa Identidade na Tabela Detalhada
            updateTabelaDetalhada(filteredData);

            // Reseta se não houver dados.
            if (rawData.length === 0) {
                 document.getElementById('total-previsto').textContent = 0;
                 document.getElementById('efetivo-presente-dia-card').textContent = 0;
                 document.getElementById('efetivo-ausente-dia-card').textContent = 0;
                 document.getElementById('vtr-servico').textContent = 0;
                 updateCharts({ presente: 0, ausente: 0, graduacao: {} });
            }
        }

        /** Atualiza os gráficos do Chart.js. */
        function updateCharts(data) {
            // A. Gráfico de Efetivo (Presente vs. Ausente)
            efetivoChartInstance.data.datasets[0].data = [data.presente, data.ausente >= 0 ? data.ausente : 0];
            efetivoChartInstance.update();

            // B. Efetivo Ativo por Graduação
            const gradLables = Object.keys(data.graduacao).sort((a, b) => {
                 // Ordem de precedência (ajustada para visualização militar)
                 const order = ['CORONEL', 'MAJOR', 'CAPITÃO', 'TENENTE', 'SUBTENENTE', 'SARGENTO', 'CABO', 'SOLDADO', 'Sem Graduação'];
                 return order.indexOf(a) - order.indexOf(b);
            });
            const gradData = gradLables.map(key => data.graduacao[key]);

            graduacaoChartInstance.data.labels = gradLables;
            graduacaoChartInstance.data.datasets = [{
                label: 'Efetivo Ativo',
                data: gradData,
                backgroundColor: 'rgba(0, 188, 212, 0.8)', // Cor alterada para contraste
                borderColor: 'white',
                borderWidth: 1
            }];
            graduacaoChartInstance.update();
        }

        /** Cria uma tabela simples para os Top Locais de Atuação. */
        function updateTopLocais(efetivoPorLocal) {
            const container = document.getElementById('tabela-top-locais');
            const sortedLocais = Object.entries(efetivoPorLocal)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 10); 

            if (sortedLocais.length === 0) {
                container.innerHTML = '<p style="text-align: center; margin-top: 50px;">Nenhum local de atuação encontrado para o efetivo ativo.</p>';
                return;
            }

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 70%;">Local de Atuação</th>
                            <th style="width: 30%; text-align: right;">Total de PMs</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedLocais.forEach(([local, total]) => {
                html += `
                    <tr>
                        <td>${local}</td>
                        <td style="text-align: right; font-weight: bold;">${total}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;
            container.innerHTML = html;
        }

        /** Cria a tabela detalhada do efetivo. */
        function updateTabelaDetalhada(dadosEfetivo) {
            const container = document.getElementById('tabela-detalhada-efetivo');

            if (dadosEfetivo.length === 0) {
                container.innerHTML = '<p style="text-align: center; margin-top: 50px;">Nenhum militar encontrado para os filtros selecionados.</p>';
                return;
            }

            // Colunas ajustadas: Unidade, Graduacao, Nome_Guerra, Identidade, Local_Atuacao, Status_Efetivo
            const colunas = ['Unidade', 'Graduacao', 'Nome_Guerra', 'Identidade', 'Local_Atuacao', 'Status_Efetivo']; 
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            ${colunas.map(col => `<th>${col.replace(/_/g, ' ')}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
            `;

            dadosEfetivo.forEach(item => {
                const statusColor = item.Status_Efetivo === 'PRESENTE' ? 'var(--success)' : 'var(--danger)';
                
                html += '<tr>';
                colunas.forEach(col => {
                    let cellContent = item[col] || '--';
                    if (col === 'Status_Efetivo') {
                         cellContent = `<span style="font-weight: bold; color: ${statusColor};">${cellContent}</span>`;
                    }
                    html += `<td>${cellContent}</td>`;
                });
                html += '</tr>';
            });

            html += `
                    </tbody>
                </table>
            `;
            container.innerHTML = html;
        }


        // --- FUNÇÕES DE CONTROLE DE EVENTOS ---

        function setupEventListeners() {
            const fileInput = document.getElementById('csv-file-input');
            const unidadeSelect = document.getElementById('unidade-select');

            document.getElementById('upload-btn').addEventListener('click', () => {
                fileInput.click();
            });

            fileInput.addEventListener('change', handleFileSelect);

            unidadeSelect.addEventListener('change', function() {
                currentFilters.unidade = this.value;
                updateDashboard(currentFilters);
            });

            /* O Listener de Data foi removido */
        }


        // --- DADOS DE AMOSTRA PARA TESTE RÁPIDO (Refletindo o novo schema) ---
        function loadSampleData() {
            const sampleData = [
                { Unidade: 'Batalhão Leste', Graduacao: 'MAJOR', Nome_Guerra: 'BRAVO', Identidade: '12345', Local_Atuacao: 'Comando', Status_Efetivo: 'PRESENTE', VTRs_Servico: 5 },
                { Unidade: 'Batalhão Leste', Graduacao: 'CAPITÃO', Nome_Guerra: 'ALFA', Identidade: '54321', Local_Atuacao: 'P-3', Status_Efetivo: 'PRESENTE', VTRs_Servico: 5 },
                { Unidade: 'Batalhão Leste', Graduacao: 'TENENTE', Nome_Guerra: 'CHARLIE', Identidade: '98765', Local_Atuacao: 'Supervisão', Status_Efetivo: 'AFASTADO', VTRs_Servico: 5 },
                { Unidade: 'Batalhão Leste', Graduacao: 'SOLDADO', Nome_Guerra: 'PM001', Identidade: '56789', Local_Atuacao: 'RPA Setorial', Status_Efetivo: 'PRESENTE', VTRs_Servico: 5 },
                { Unidade: '4ª CICOM', Graduacao: 'CAPITÃO', Nome_Guerra: 'DELTA', Identidade: '44444', Local_Atuacao: 'Comando', Status_Efetivo: 'PRESENTE', VTRs_Servico: 2 },
                { Unidade: '4ª CICOM', Graduacao: 'SOLDADO', Nome_Guerra: 'PM002', Identidade: '45678', Local_Atuacao: 'Setor Urbano', Status_Efetivo: 'PRESENTE', VTRs_Servico: 2 },
                { Unidade: '9ª CICOM', Graduacao: 'SARGENTO', Nome_Guerra: 'ECHO', Identidade: '99999', Local_Atuacao: 'Setor 1', Status_Efetivo: 'PRESENTE', VTRs_Servico: 3 },
                { Unidade: '11ª CICOM', Graduacao: 'SOLDADO', Nome_Guerra: 'FOXTROT', Identidade: '11111', Local_Atuacao: 'Setor 2', Status_Efetivo: 'DE FÉRIAS', VTRs_Servico: 4 },
                { Unidade: '30ª CICOM', Graduacao: 'MAJOR', Nome_Guerra: 'KILO', Identidade: '30303', Local_Atuacao: 'Comando', Status_Efetivo: 'PRESENTE', VTRs_Servico: 3 },
                { Unidade: '30ª CICOM', Graduacao: 'SOLDADO', Nome_Guerra: 'LIMA', Identidade: '30304', Local_Atuacao: 'RPA', Status_Efetivo: 'FALTA', VTRs_Servico: 3 },
            ];

            // Aplica a normalização de status (simulação do que a função readExcelFile faz)
            const normalizedData = sampleData.map(item => {
                 item.Status_Efetivo = item.Status_Efetivo ? String(item.Status_Efetivo).toUpperCase().trim() : 'NAO INFORMADO';
                 item.Efetivo_Presente = item.Status_Efetivo === 'PRESENTE' ? 1 : 0;
                 item.Efetivo_Ausente = item.Status_Efetivo !== 'PRESENTE' ? 1 : 0;
                 item.Efetivo_Previsto = 1; 
                 item.VTRs_Servico = parseInt(item.VTRs_Servico) || 0;
                 return item;
            });
            
            processExcelData(normalizedData);
            showAlert('Dados de amostra carregados com sucesso!', 'success');
        }


        // --- INICIALIZAÇÃO GERAL ---
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            updateDateTime();
            setInterval(updateDateTime, 60000); 
            setupCharts(); 
            setupEventListeners(); 
            loadSampleData(); // CARREGA OS DADOS DE TESTE AUTOMATICAMENTE
        });
    </script>
</body>
</html>
